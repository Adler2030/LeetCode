# 进出栈序列

**题目描述**

&#x20;       n 个元素进栈序列为：1，2，3，4，...，n，则有多少种出栈序列。

**思路**

&#x20;       我们将进栈表示为 +1，出栈表示为 -1，则 1 3 2 的出栈序列可以表示为：+1 -1 +1 +1 -1 -1。

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

&#x20;       根据栈本身的特点，每次出栈的时候，必定之前有元素入栈，即对于每个 -1 前面都有一个 +1 相对应。因此，出栈序列的 **所有前缀和** 必然大于等于 0，并且 +1 的数量 **等于** -1 的数量。

&#x20;       接下来让我们观察一下 n = 3 的一种出栈序列：+1 -1 -1 +1 -1 +1。序列前三项和小于 0，显然这是个非法的序列。

&#x20;       如果将 **第一个** 前缀和小于 0 的前缀，即前三项元素都进行取反，就会得到：-1 +1 +1 +1 -1 +1。此时有 3 + 1 个 +1 以及 3 - 1 个 -1。

&#x20;       因为这个小于 0 的前缀和必然是 -1，且 -1 比 +1 多一个，取反后，-1 比 +1 少一个，则 +1 变为 n + 1 个，且 -1 变为 n - 1 个。进一步推广，对于 n 元素的每种非法出栈序列，都会对应一个含有 n + 1 个 +1 以及 n - 1个 -1 的序列。

&#x20;       如何证明这两种序列是一一对应的？

&#x20;       假设非法序列为 A，对应的序列为 B。每个 A 只有一个"**第一个前缀和小于 0 的前缀**"，所以每个 A 只能产生一个 B。而每个 B 想要还原到 A，就需要找到"**第一个前缀和大于 0 的前缀**"，显然 B 也只能产生一个 A。

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

&#x20;       每个 B 都有 n + 1 个 +1 以及 n - 1 个 -1，因此 B 的数量为  $$C^{n+1}_{2n}$$，相当于在长度为 2n 的序列中找到`n + 1`个位置存放 +1。相应的，非法序列的数量也就等于 $$C^{n+1}_{2n}$$ 。

&#x20;       出栈序列的总数量共有 $$C^{n}_{2n}$$ ，因此，合法的出栈序列的数量为$$C^{n}_{2n} - C^{n+1}_{2n}  =C^{n+1}_{2n}/(n+1)$$。

&#x20;       此时我们就得到了卡特兰数的通项 $$C^{n+1}_{2n}/(n+1)$$ ，至于具体如何计算结果将会在后面进行介绍。
